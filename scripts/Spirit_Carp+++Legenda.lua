-- STEP TELEPORT (файловый счётчик) — 1 клик = следующий поинт

-- === ФАЙЛ СЧЁТЧИКА (в той же папке, что и lua) ===
local PATH = "tp_idx.txt"

-- Полезные алиасы
local Vector3 = CS.UnityEngine.Vector3

local function show(msg)
  if CS and CS.MoleMole and CS.MoleMole.ActorUtils and CS.MoleMole.ActorUtils.ShowMessage then
    CS.MoleMole.ActorUtils.ShowMessage(tostring(msg))
  else
    print(tostring(msg))
  end
end

-- === СПИСОК ВАЙПОИНТОВ (Ca Chep, 51 шт) ===
local W = {
  {name="Ca Chep 1",  x=1978.2099609375, y=295.1130065917969, z=1593.949951171875},
  {name="Ca Chep 2",  x=1388.5699462890625, y=267.2040100097656, z=1943.2099609375},
  {name="Ca Chep 3",  x=1328.97998046875, y=238.10499572753906, z=1745.489990234375},
  {name="Ca Chep 4",  x=1203.2900390625, y=293.0820007324219, z=1918.699951171875},
  {name="Ca Chep 5",  x=1748.4599609375, y=375.5096130371094, z=1425.13818359375},
  {name="Ca Chep 6",  x=1164.02001953125, y=443.0069885253906, z=2050.39990234375},
  {name="Ca Chep 7",  x=1220.18994140625, y=329.9859924316406, z=2144.64990234375},
  {name="Ca Chep 8",  x=1072.6500244140625, y=349.4620056152344, z=2354.280029296875},
  {name="Ca Chep 9",  x=1369.3900146484375, y=378.6369934082031, z=2105.75},
  {name="Ca Chep 10", x=1439.97998046875, y=409.57598876953125, z=2206.449951171875},
  {name="Ca Chep 11", x=1481.5899658203125, y=278.55499267578125, z=2194.159912109375},
  {name="Ca Chep 12", x=1662.300048828125, y=261.9159851074219, z=1660.030029296875},
  {name="Ca Chep 13", x=1558.0999755859375, y=408.2980041503906, z=2185.389892578125},
  {name="Ca Chep 14", x=1657.8299560546875, y=377.5639953613281, z=2344.93994140625},
  {name="Ca Chep 15", x=1526.6500244140625, y=379.7950134277344, z=2295.7099609375},
  {name="Ca Chep 16", x=1463.9300537109375, y=423.9620056152344, z=2342.860107421875},
  {name="Ca Chep 17", x=1639.4100341796875, y=418.4159851074219, z=2185.68994140625},
  {name="Ca Chep 18", x=1777.0899658203125, y=336.5400085449219, z=2184.260009765625},
  {name="Ca Chep 19", x=1750.81005859375, y=418.86199951171875, z=2233.070068359375},
  {name="Ca Chep 20", x=2301.39990234375, y=304.81298828125, z=1516.6099853515625},
  {name="Ca Chep 21", x=2386.840087890625, y=340.885009765625, z=1537.7900390625},
  {name="Ca Chep 22", x=2560.300048828125, y=367.8210144042969, z=1796.6700439453125},
  {name="Ca Chep 23", x=1123.550048828125, y=354.2760009765625, z=1941.989990234375},
  {name="Ca Chep 24", x=2469.93994140625, y=329.74700927734375, z=1813.1500244140625},
  {name="Ca Chep 25", x=2401.77001953125, y=378.1789855957031, z=1966.5},
  {name="Ca Chep 26", x=2144.090087890625, y=322.3590087890625, z=1678.3199462890625},
  {name="Ca Chep 27", x=2250.550048828125, y=424.5929870605469, z=1844.530029296875},
  {name="Ca Chep 28", x=2177.1298828125, y=405.5450134277344, z=1899.1700439453125},
  {name="Ca Chep 29", x=2251.1298828125, y=444.52398681640625, z=2005.3800048828125},
  {name="Ca Chep 30", x=2008.239990234375, y=586.7789916992188, z=2212.60009765625},
  {name="Ca Chep 31", x=1903.06005859375, y=391.77801513671875, z=2075.27001953125},
  {name="Ca Chep 32", x=2369.070068359375, y=339.25799560546875, z=2161.8798828125},
  {name="Ca Chep 33", x=2512.719970703125, y=458.5849914550781, z=2150.10009765625},
  {name="Ca Chep 34", x=1831.0999755859375, y=295.3529968261719, z=1375.9000244140625},
  {name="Ca Chep 35", x=2624.969970703125, y=342.3219909667969, z=2254.6201171875},
  {name="Ca Chep 36", x=2555.52001953125, y=383.3550109863281, z=2374.2099609375},
  {name="Ca Chep 37", x=2651.2900390625, y=413.9119873046875, z=2463.699951171875},
  {name="Ca Chep 38", x=2524.070068359375, y=603.6890258789063, z=2625.919921875},
  {name="Ca Chep 39", x=2332.320068359375, y=518.7630004882813, z=2511.18994140625},
  {name="Ca Chep 40", x=2173.780029296875, y=436.5190124511719, z=2612.9599609375},
  {name="Ca Chep 41", x=2054.010009765625, y=362.3810119628906, z=2715.43994140625},
  {name="Ca Chep 42", x=1937.31005859375, y=481.27301025390625, z=2607.219970703125},
  {name="Ca Chep 43", x=1519.9000244140625, y=402.68798828125, z=2878.22998046875},
  {name="Ca Chep 44", x=1435.9200439453125, y=434.20098876953125, z=2749.169921875},
  {name="Ca Chep 45", x=1561.4300537109375, y=177.91900634765625, z=1750.1099853515625},
  {name="Ca Chep 46", x=2225.25, y=362.88299560546875, z=2069.25},
  {name="Ca Chep 47", x=1521.6600341796875, y=210.41000366210938, z=1898.6300048828125},
  {name="Ca Chep 48", x=1591.219970703125, y=212.77999877929688, z=1919.5400390625},
  {name="Ca Chep 49", x=1539.22998046875, y=416.59600830078125, z=1871.1700439453125},
  {name="Ca Chep 50", x=1545.219970703125, y=435.5299987792969, z=1968.8599853515625},
  {name="Ca Chep 51", x=1498.752197265625, y=-44.825748443603516, z=2746.009765625},
}

-- читаем индекс из файла
local function read_idx()
  local f = io.open(PATH, "r")
  if f then
    local s = f:read("*l")
    f:close()
    local n = tonumber(s)
    if n and n >= 1 and n <= #W then return n end
  end
  return 1
end

-- пишем индекс в файл
local function write_idx(n)
  local ok, err = pcall(function()
    local f = io.open(PATH, "w")
    if f then f:write(tostring(n)); f:close() end
  end)
  if not ok then
    show("Ошибка записи: " .. tostring(err))
  end
end

-- основной шаг
local idx = read_idx()
local wp  = W[idx]

-- тп
local pos = Vector3(wp.x, wp.y, wp.z)
CS.MoleMole.ActorUtils.SetAvatarPos(pos)
show(string.format("TP %d/%d: %s  (X:%.2f Y:%.2f Z:%.2f)  [next-> %d]",
  idx, #W, wp.name, wp.x, wp.y, wp.z, (idx % #W) + 1))

-- следующий индекс (циклично) и сохранение
idx = idx + 1
if idx > #W then idx = 1 end
write_idx(idx)
