-- STEP TELEPORT (файловый счётчик) — 1 клик = следующий поинт

-- === ФАЙЛ СЧЁТЧИКА (в той же папке, что и lua) ===
local PATH = "tp_idx.txt"

-- Полезные алиасы
local Vector3 = CS.UnityEngine.Vector3

local function show(msg)
  if CS and CS.MoleMole and CS.MoleMole.ActorUtils and CS.MoleMole.ActorUtils.ShowMessage then
    CS.MoleMole.ActorUtils.ShowMessage(tostring(msg))
  else
    print(tostring(msg))
  end
end

-- === СПИСОК ВАЙПОИНТОВ (из файла) ===
local W = {
  {name="TP 1", x=-827.177063, y=202.373093, z=2293.655029},
  {name="TP 2", x=-10.698912, y=262.816803, z=2345.770508},
  {name="TP 3", x=-624.661682, y=206.566895, z=2458.386475},
  {name="TP 4", x=-434.254730, y=286.438873, z=2216.647705},
  {name="TP 5", x=113.443985, y=288.005585, z=2071.535156},
  {name="TP 6", x=350.253540, y=318.108185, z=2414.779541},
  {name="TP 7", x=149.673523, y=330.482117, z=2403.364502},
  {name="TP 8", x=7.149954, y=226.066650, z=2479.313477},
  {name="TP 9", x=-138.160522, y=243.807098, z=2547.067871},
  {name="TP 10", x=17.140100, y=309.121216, z=2804.156738},
  {name="TP 11", x=-284.573151, y=242.503220, z=2871.441895},
  {name="TP 12", x=-373.858063, y=343.750153, z=2876.180908},
  {name="TP 13", x=-479.776611, y=223.404770, z=2790.122559},
  {name="TP 14", x=-417.745178, y=273.160065, z=2689.948242},
  {name="TP 15", x=-557.346191, y=217.875000, z=2647.275146},
  {name="TP 16", x=-765.468079, y=227.235184, z=2698.719238},
  {name="TP 17", x=-1018.603760, y=202.440506, z=2626.459961},
  {name="TP 18", x=-1418.002197, y=278.067078, z=2567.246094},
  {name="TP 19", x=-1221.788452, y=318.896088, z=2795.209961},
  {name="TP 20", x=-1790.665039, y=301.722870, z=2799.328125},
  {name="TP 21", x=-1941.979004, y=204.930054, z=2685.070312},
  {name="TP 22", x=-1900.462280, y=245.148178, z=2581.295166},
  {name="TP 23", x=-1686.012939, y=455.274384, z=2238.944824},
  {name="TP 24", x=-1209.750854, y=184.935562, z=2275.292480},
  {name="TP 25", x=-1169.563110, y=285.546265, z=3404.004150},
  {name="TP 26", x=-1421.306885, y=347.615173, z=3648.127197},
  {name="TP 27", x=-1461.570435, y=251.568695, z=3432.036133},
  {name="TP 28", x=-1571.934814, y=187.794601, z=3473.269531},
  {name="TP 29", x=-1996.056152, y=474.352356, z=3553.459229},
  {name="TP 30", x=-1802.585938, y=2.025619, z=3311.518311},
  {name="TP 31", x=-1732.737549, y=272.373749, z=3134.383301},
  {name="TP 32", x=-1081.390381, y=288.175262, z=3127.137939},
  {name="TP 33", x=-912.802490, y=389.839111, z=3200.040283},
  {name="TP 34", x=-717.474121, y=269.579803, z=3074.232422},
  {name="TP 35", x=-599.919861, y=242.859039, z=3250.161865},
  {name="TP 36", x=-610.333191, y=120.768188, z=3482.404785},
  {name="TP 37", x=-791.361816, y=239.970352, z=3588.147461},
  {name="TP 38", x=-994.316956, y=372.074127, z=4005.702881},
  {name="TP 39", x=-505.103546, y=260.619141, z=3706.505859},
  {name="TP 40", x=-240.936676, y=363.485260, z=4046.044922},
  {name="TP 41", x=-161.082458, y=96.433609, z=3932.420654},
  {name="TP 42", x=405.842834, y=287.510101, z=3282.617432},
  {name="TP 43", x=-1993.749268, y=286.437408, z=3986.707520},
  {name="TP 44", x=-1658.001831, y=261.422638, z=3861.831787},
  {name="TP 45", x=-2024.919434, y=300.117767, z=4093.349854},
  {name="TP 46", x=-2169.459961, y=285.893372, z=4076.397217},
  {name="TP 47", x=-2471.613281, y=337.838104, z=4040.492920},
  {name="TP 48", x=-2716.040527, y=276.869019, z=4211.080078},
  {name="TP 49", x=-2462.370850, y=247.240814, z=4451.954102},
  {name="TP 50", x=-2351.257813, y=108.553070, z=4691.458496},
  {name="TP 51", x=-1869.373901, y=384.907776, z=4401.478027},
  {name="TP 52", x=-1666.604126, y=297.357697, z=4283.232422},
  {name="TP 53", x=-2915.434082, y=261.516663, z=4477.886719},
  {name="TP 54", x=-2724.758057, y=68.744125, z=4385.986816},
  {name="TP 55", x=-3185.327148, y=325.513092, z=4798.269043},
  {name="TP 56", x=-2735.364502, y=296.270355, z=4813.931641},
  {name="TP 57", x=-2578.198975, y=206.142349, z=4795.813477},
  {name="TP 58", x=-2155.575684, y=169.789230, z=4993.480957},
  {name="TP 59", x=-2777.184326, y=160.057159, z=5142.527832},
  {name="TP 60", x=-2852.769531, y=200.373413, z=5713.449219},
  {name="TP 61", x=-2127.487305, y=171.822754, z=5978.825195},
  {name="TP 62", x=-1807.381226, y=18.419071, z=5730.717285},
  {name="TP 63", x=-1642.499756, y=23.465881, z=5818.599121},
  {name="TP 64", x=-1795.420532, y=128.545441, z=5043.818359},
  {name="TP 65", x=-1586.338379, y=97.343460, z=5072.933105},
  {name="TP 66", x=-1440.250488, y=90.460724, z=4776.799805},
  {name="TP 67", x=-1339.032227, y=55.608189, z=5200.786621},
  {name="TP 68", x=-1461.896000, y=7.927508, z=5411.314941},
  {name="TP 69", x=-1242.065308, y=51.316616, z=5485.684082},
  {name="TP 70", x=-1302.429443, y=15.340096, z=5762.028809},
  {name="TP 71", x=-706.128784, y=93.448723, z=5684.968750},
  {name="TP 72", x=-755.121216, y=-338.762268, z=5418.068848},
  {name="TP 73", x=-517.756287, y=-51.263943, z=5485.778809},
  {name="TP 74", x=-408.444061, y=204.725861, z=5572.749023},
  {name="TP 75", x=-204.927048, y=85.158257, z=5304.151367},
  {name="TP 76", x=-257.100586, y=-23.286909, z=4690.504395},
  {name="TP 77", x=-692.584473, y=212.066544, z=4955.847656},
  {name="TP 78", x=-801.219421, y=-135.078293, z=4933.904297},
  {name="TP 79", x=-987.264954, y=111.233086, z=4767.698730},
  {name="TP 80", x=-1076.186890, y=76.164963, z=4580.224609},
  {name="TP 81", x=-514.290405, y=179.364075, z=4267.471191},
  {name="TP 82", x=481.149170, y=325.598602, z=6184.944824},
  {name="TP 83", x=-317.488892, y=138.067642, z=5986.679688},
  {name="TP 84", x=-1.246539, y=227.948181, z=6166.744629},
  {name="TP 85", x=343.163605, y=235.055695, z=6605.115723},
  {name="TP 86", x=379.807617, y=318.125031, z=6817.581543},
  {name="TP 87", x=682.018066, y=156.944412, z=6746.988281},
  {name="TP 88", x=722.487549, y=335.888245, z=6612.791016},
  {name="TP 89", x=743.562378, y=305.893799, z=6339.556641},
  {name="TP 90", x=616.501526, y=323.558563, z=5945.365234},
  {name="TP 91", x=426.670227, y=316.356049, z=5893.374023},
  {name="TP 92", x=440.859802, y=309.629150, z=5696.322754},
  {name="TP 93", x=797.787415, y=325.674408, z=5795.093262},
  {name="TP 94", x=743.235046, y=212.802887, z=5991.439941},
  {name="TP 95", x=1213.385498, y=446.612854, z=5989.185059},
  {name="TP 96", x=1441.486206, y=464.368469, z=5492.188477},
  {name="TP 97", x=-355.190948, y=218.510986, z=3102.607178},
  {name="TP 98", x=-329.978760, y=205.124008, z=3293.236328},
  {name="TP 99", x=845.278320, y=381.021332, z=6058.035645},
  {name="TP 100", x=-498.306976, y=267.597900, z=5177.166016},
  {name="TP 101", x=-654.201050, y=104.897766, z=4589.563965},
  {name="TP 102", x=-564.190857, y=283.370880, z=2212.309082},
  {name="TP 103", x=-1453.547485, y=235.335052, z=2969.108398},
  {name="TP 104", x=-826.434753, y=109.689995, z=3348.295166},
  {name="TP 105", x=-93.956398, y=201.529327, z=3015.409424},
  {name="TP 106", x=-1841.944092, y=7.413046, z=3232.030518},
  {name="TP 107", x=-1747.314087, y=226.859222, z=3471.691406},
  {name="TP 108", x=-2035.223511, y=105.259949, z=4418.566895},
  {name="TP 109", x=-2249.402344, y=10.961739, z=5276.334473},
  {name="TP 110", x=-1806.956665, y=157.684311, z=5633.333496},
  {name="TP 111", x=-1407.528320, y=28.194977, z=4291.836426},
  {name="TP 112", x=-741.242737, y=-20.441082, z=4427.788086},
  {name="TP 113", x=-377.571136, y=224.792099, z=4999.583984},
  {name="TP 114", x=-74.215797, y=235.454834, z=6054.391602},
  {name="TP 115", x=390.390076, y=322.443146, z=5535.530273},
  {name="TP 116", x=927.866089, y=432.353638, z=6143.998047},
}


-- читаем индекс из файла
local function read_idx()
  local f = io.open(PATH, "r")
  if f then
    local s = f:read("*l")
    f:close()
    local n = tonumber(s)
    if n and n >= 1 and n <= #W then return n end
  end
  return 1
end

-- пишем индекс в файл
local function write_idx(n)
  local okw, err = pcall(function()
    local f = io.open(PATH, "w")
    if f then f:write(tostring(n)); f:close() end
  end)
  if not okw then
    show("Ошибка записи: " .. tostring(err))
  end
end

-- основной шаг
local idx = read_idx()
local wp  = W[idx]

-- тп
local pos = Vector3(wp.x, wp.y, wp.z)
CS.MoleMole.ActorUtils.SetAvatarPos(pos)
show(string.format("TP %d/%d: %s  (X:%.2f Y:%.2f Z:%.2f)  [next-> %d]",
  idx, #W, wp.name, wp.x, wp.y, wp.z, (idx % #W) + 1))

-- следующий индекс (циклично) и сохранение
idx = idx + 1
if idx > #W then idx = 1 end
write_idx(idx)