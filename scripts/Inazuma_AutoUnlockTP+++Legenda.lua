-- STEP TELEPORT (файловый счётчик) — 1 клик = следующий поинт

-- === ФАЙЛ СЧЁТЧИКА (в той же папке, что и lua) ===
local PATH = "tp_idx.txt"

-- Полезные алиасы
local Vector3 = CS.UnityEngine.Vector3

local function show(msg)
  if CS and CS.MoleMole and CS.MoleMole.ActorUtils and CS.MoleMole.ActorUtils.ShowMessage then
    CS.MoleMole.ActorUtils.ShowMessage(tostring(msg))
  else
    print(tostring(msg))
  end
end

-- === СПИСОК ВАЙПОИНТОВ (из файла) ===
local W = {
  {name="TP 1", x=-2426.000000, y=258.276245, z=-3902.508545},
  {name="TP 2", x=-2530.431152, y=202.122513, z=-3635.222168},
  {name="TP 3", x=-2548.606934, y=213.327637, z=-3808.672119},
  {name="TP 4", x=-2657.825439, y=206.703323, z=-4041.038086},
  {name="TP 5", x=-2753.493896, y=205.501495, z=-4123.469727},
  {name="TP 6", x=-3003.732910, y=207.897461, z=-4220.871094},
  {name="TP 7", x=-3050.654297, y=247.208725, z=-4399.749023},
  {name="TP 8", x=-3218.684082, y=265.566559, z=-4495.784668},
  {name="TP 9", x=-2801.605957, y=223.543320, z=-4429.927734},
  {name="TP 10", x=-2580.960449, y=273.966614, z=-4583.438477},
  {name="TP 11", x=-2501.099854, y=443.743134, z=-4379.503906},
  {name="TP 12", x=-2399.611084, y=256.287994, z=-4406.453125},
  {name="TP 13", x=-2398.962158, y=286.660370, z=-4221.133789},
  {name="TP 14", x=-2147.005859, y=170.598618, z=-4353.582520},
  {name="TP 15", x=-2159.480957, y=162.447571, z=-4505.964844},
  {name="TP 16", x=-1768.866089, y=226.358032, z=-4123.289551},
  {name="TP 17", x=-3203.499512, y=203.999908, z=-3934.234619},
  {name="TP 18", x=-3531.961914, y=236.376373, z=-3239.439697},
  {name="TP 19", x=-3159.874512, y=209.703705, z=-3233.654053},
  {name="TP 20", x=-3314.437256, y=232.150253, z=-3437.710449},
  {name="TP 21", x=-3554.989746, y=237.158676, z=-3397.408936},
  {name="TP 22", x=-3752.075195, y=206.164551, z=-3478.406250},
  {name="TP 23", x=-3653.104980, y=273.718018, z=-3292.343994},
  {name="TP 24", x=-3872.087891, y=213.752777, z=-3229.465820},
  {name="TP 25", x=-3890.395996, y=363.752014, z=-3155.674316},
  {name="TP 26", x=-3620.390625, y=234.305893, z=-3020.526611},
  {name="TP 27", x=-3701.799805, y=243.452957, z=-2215.787598},
  {name="TP 28", x=-3409.376953, y=200.362366, z=-2741.460449},
  {name="TP 29", x=-3541.529053, y=200.832428, z=-2538.458496},
  {name="TP 30", x=-3486.205566, y=215.067673, z=-2196.613037},
  {name="TP 31", x=-3570.354980, y=216.258545, z=-1962.626099},
  {name="TP 32", x=-3772.466797, y=250.795288, z=-2366.631836},
  {name="TP 33", x=-3922.455322, y=345.184601, z=-2402.477783},
  {name="TP 34", x=-4128.513184, y=200.928467, z=-2397.929443},
  {name="TP 35", x=-3831.891357, y=242.983093, z=-578.336670},
  {name="TP 36", x=-3771.433350, y=207.431366, z=-1316.319214},
  {name="TP 37", x=-3948.700684, y=204.733124, z=-1059.012329},
  {name="TP 38", x=-4003.456299, y=212.381775, z=-757.010681},
  {name="TP 39", x=-3796.878906, y=164.491196, z=-762.295532},
  {name="TP 40", x=-3561.155762, y=201.473267, z=-766.321655},
  {name="TP 41", x=-3608.151123, y=176.948318, z=-1131.542847},
  {name="TP 42", x=-4434.701172, y=219.185699, z=-4028.248535},
  {name="TP 43", x=-4688.542969, y=215.479935, z=-3699.324951},
  {name="TP 44", x=-4281.452148, y=201.372421, z=-3678.995361},
  {name="TP 45", x=-4394.750000, y=248.543365, z=-3891.987549},
  {name="TP 46", x=-4386.926270, y=249.401611, z=-4189.767090},
  {name="TP 47", x=-4247.519531, y=203.593781, z=-4189.643066},
  {name="TP 48", x=-4298.499023, y=203.577057, z=-4210.824219},
  {name="TP 49", x=-4285.247070, y=218.103577, z=-4445.892090},
  {name="TP 50", x=-4576.026855, y=200.533463, z=-4477.563477},
  {name="TP 51", x=-4792.100586, y=512.784119, z=-4253.169434},
  {name="TP 52", x=-4570.667969, y=418.035370, z=-4167.620117},
  {name="TP 53", x=-6132.543945, y=212.909851, z=-3269.970459},
  {name="TP 54", x=-6272.887695, y=204.839462, z=-3104.528076},
  {name="TP 55", x=-6287.329102, y=240.201431, z=-2840.100342},
  {name="TP 56", x=-6044.169922, y=207.055710, z=-2807.463379},
  {name="TP 57", x=-6002.226563, y=282.623871, z=-2550.028076},
  {name="TP 58", x=-6213.891602, y=245.484940, z=-2611.096436},
  {name="TP 59", x=-6501.106934, y=250.166702, z=-2610.430908},
  {name="TP 60", x=-6692.333008, y=227.022919, z=-2599.766113},
}

-- читаем индекс из файла
local function read_idx()
  local f = io.open(PATH, "r")
  if f then
    local s = f:read("*l")
    f:close()
    local n = tonumber(s)
    if n and n >= 1 and n <= #W then return n end
  end
  return 1
end

-- пишем индекс в файл
local function write_idx(n)
  local okw, err = pcall(function()
    local f = io.open(PATH, "w")
    if f then f:write(tostring(n)); f:close() end
  end)
  if not okw then
    show("Ошибка записи: " .. tostring(err))
  end
end

-- основной шаг
local idx = read_idx()
local wp  = W[idx]

-- тп
local pos = Vector3(wp.x, wp.y, wp.z)
CS.MoleMole.ActorUtils.SetAvatarPos(pos)
show(string.format("TP %d/%d: %s  (X:%.2f Y:%.2f Z:%.2f)  [next-> %d]",
  idx, #W, wp.name, wp.x, wp.y, wp.z, (idx % #W) + 1))

-- следующий индекс (циклично) и сохранение
idx = idx + 1
if idx > #W then idx = 1 end
write_idx(idx)