-- STEP TELEPORT (файловый счётчик) — 1 клик = следующий поинт

-- === ФАЙЛ СЧЁТЧИКА (в той же папке, что и lua) ===
local PATH = "tp_idx.txt"

-- Полезные алиасы
local Vector3 = CS.UnityEngine.Vector3

local function show(msg)
  if CS and CS.MoleMole and CS.MoleMole.ActorUtils and CS.MoleMole.ActorUtils.ShowMessage then
    CS.MoleMole.ActorUtils.ShowMessage(tostring(msg))
  else
    print(tostring(msg))
  end
end

-- === СПИСОК ВАЙПОИНТОВ (Телепорты Liyue) ===
local W = {
  {name="TP 1", x=1283.171631, y=204.725281, z=251.650574},
  {name="TP 2", x=1182.262695, y=203.609711, z=-160.238495},
  {name="TP 3", x=1470.319092, y=244.500244, z=-321.166138},
  {name="TP 4", x=1570.362793, y=227.806763, z=203.528000},
  {name="TP 5", x=1669.567627, y=201.119370, z=292.051331},
  {name="TP 6", x=1709.577881, y=286.182220, z=383.416687},
  {name="TP 7", x=1768.113770, y=255.828857, z=543.932007},
  {name="TP 8", x=1791.071289, y=231.724152, z=799.461792},
  {name="TP 9", x=1530.024048, y=210.666092, z=841.331360},
  {name="TP 10", x=1562.554688, y=227.949265, z=1274.749146},
  {name="TP 11", x=1446.316650, y=252.288956, z=482.233643},
  {name="TP 12", x=878.699707, y=265.206421, z=329.082153},
  {name="TP 13", x=627.892090, y=331.406738, z=-256.995789},
  {name="TP 14", x=968.038147, y=260.251862, z=-187.319885},
  {name="TP 15", x=733.945984, y=250.485077, z=-416.009521},
  {name="TP 16", x=440.631104, y=200.464478, z=-477.492432},
  {name="TP 17", x=658.242798, y=204.772614, z=-55.075027},
  {name="TP 18", x=542.067810, y=206.721649, z=338.663757},
  {name="TP 19", x=384.494080, y=203.736145, z=178.970825},
  {name="TP 20", x=225.321884, y=232.913101, z=487.112885},
  {name="TP 21", x=100.553680, y=175.592056, z=526.044312},
  {name="TP 22", x=242.793991, y=237.832336, z=836.221313},
  {name="TP 23", x=762.853455, y=409.620331, z=1472.259766},
  {name="TP 24", x=1291.166748, y=282.262512, z=1432.435547},
  {name="TP 25", x=1188.153198, y=261.105316, z=1114.095093},
  {name="TP 26", x=1063.522705, y=205.069290, z=725.760315},
  {name="TP 27", x=945.560303, y=280.549164, z=1044.470459},
  {name="TP 28", x=1027.565308, y=268.889923, z=1447.003418},
  {name="TP 29", x=1044.160522, y=392.336273, z=1603.659668},
  {name="TP 30", x=831.764404, y=475.280212, z=1434.481201},
  {name="TP 31", x=743.619873, y=174.033203, z=1133.069702},
  {name="TP 32", x=622.702332, y=186.865570, z=1184.970703},
  {name="TP 33", x=585.572388, y=214.271027, z=894.996460},
  {name="TP 34", x=515.239624, y=361.470062, z=1392.477539},
  {name="TP 35", x=714.132446, y=427.444916, z=1798.375000},
  {name="TP 36", x=390.340332, y=235.035614, z=1664.824829},
  {name="TP 37", x=140.303268, y=215.794952, z=1150.951660},
  {name="TP 38", x=-64.550751, y=233.928192, z=1264.785400},
  {name="TP 39", x=-10.777023, y=271.884430, z=253.816132},
  {name="TP 40", x=136.485260, y=271.492218, z=54.170738},
  {name="TP 41", x=-115.975769, y=279.009735, z=26.506042},
  {name="TP 42", x=-244.573471, y=265.664368, z=293.451111},
  {name="TP 43", x=-280.871643, y=369.728333, z=609.034790},
  {name="TP 44", x=-623.160767, y=366.013458, z=526.030273},
  {name="TP 45", x=-506.452698, y=229.204239, z=372.285431},
  {name="TP 46", x=-665.437256, y=220.846298, z=270.757538},
  {name="TP 47", x=-345.213287, y=286.495026, z=987.968689},
  {name="TP 48", x=-769.890442, y=225.126160, z=713.961426},
  {name="TP 49", x=-584.056030, y=312.591431, z=828.569763},
  {name="TP 50", x=-583.243103, y=213.424469, z=889.037354},
  {name="TP 51", x=-559.416077, y=226.166733, z=1036.532837},
  {name="TP 52", x=-989.558777, y=256.169464, z=1122.835449},
  {name="TP 53", x=-90.437103, y=203.679184, z=-665.547363},
  {name="TP 54", x=-292.013641, y=212.347260, z=-965.084778},
  {name="TP 55", x=-682.444580, y=238.407516, z=1998.072632},
  {name="TP 56", x=-782.912415, y=162.707504, z=2019.054810},
  {name="TP 57", x=-762.233459, y=143.790771, z=1914.140869},
  {name="TP 58", x=-868.044312, y=127.216957, z=1760.005615},
  {name="TP 59", x=-726.830872, y=209.859787, z=1466.646484},
  {name="TP 60", x=-581.513062, y=140.977173, z=1706.553467},
  {name="TP 61", x=-476.550232, y=180.374680, z=1898.422119},
  {name="TP 62", x=-285.319977, y=294.211670, z=1659.130737},
}

-- читаем индекс из файла
local function read_idx()
  local f = io.open(PATH, "r")
  if f then
    local s = f:read("*l")
    f:close()
    local n = tonumber(s)
    if n and n >= 1 and n <= #W then return n end
  end
  return 1
end

-- пишем индекс в файл
local function write_idx(n)
  local okw, err = pcall(function()
    local f = io.open(PATH, "w")
    if f then f:write(tostring(n)); f:close() end
  end)
  if not okw then
    show("Ошибка записи: " .. tostring(err))
  end
end

-- основной шаг
local idx = read_idx()
local wp  = W[idx]

-- тп
local pos = Vector3(wp.x, wp.y, wp.z)
CS.MoleMole.ActorUtils.SetAvatarPos(pos)
show(string.format("TP %d/%d: %s  (X:%.2f Y:%.2f Z:%.2f)  [next-> %d]",
  idx, #W, wp.name, wp.x, wp.y, wp.z, (idx % #W) + 1))

-- следующий индекс (циклично) и сохранение
idx = idx + 1
if idx > #W then idx = 1 end
write_idx(idx)
